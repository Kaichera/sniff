{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sniff.dev/schemas/config.schema.json",
  "title": "Sniff Agent Configuration",
  "description": "Schema for Sniff agent configuration file (sniff.yml) version 1.0",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Configuration schema version"
    },
    "agents": {
      "type": "array",
      "minItems": 1,
      "description": "Array of agent definitions",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z0-9-]+$",
            "description": "Unique identifier for the agent"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Human-readable display name"
          },
          "description": {
            "type": "string",
            "maxLength": 500,
            "description": "Brief description of the agent's purpose"
          },
          "system_prompt": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50000,
            "description": "Core instructions that define how the agent thinks and responds"
          },
          "model": {
            "type": "object",
            "description": "Model configuration (currently only Anthropic supported)",
            "properties": {
              "anthropic": {
                "type": "object",
                "description": "Anthropic Claude model configuration",
                "properties": {
                  "name": {
                    "type": "string",
                    "default": "claude-sonnet-4-20250514",
                    "description": "The Claude model to use"
                  },
                  "temperature": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 1,
                    "description": "Controls randomness (0-1)"
                  },
                  "max_tokens": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 8192,
                    "default": 4096,
                    "description": "Maximum tokens for the response"
                  },
                  "top_p": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Nucleus sampling parameter"
                  },
                  "top_k": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Top-k sampling parameter"
                  },
                  "stop_sequences": {
                    "type": "array",
                    "maxItems": 10,
                    "items": {
                      "type": "string"
                    },
                    "description": "Custom stop sequences"
                  },
                  "thinking": {
                    "description": "Extended thinking configuration",
                    "oneOf": [
                      {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "const": "enabled"
                          },
                          "budget_tokens": {
                            "type": "integer",
                            "minimum": 1024,
                            "description": "Token budget for thinking"
                          }
                        },
                        "required": ["type", "budget_tokens"],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "const": "disabled"
                          }
                        },
                        "required": ["type"],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "metadata": {
                    "type": "object",
                    "properties": {
                      "user_id": {
                        "type": "string",
                        "maxLength": 256,
                        "description": "Opaque user identifier for tracking"
                      }
                    },
                    "additionalProperties": false
                  },
                  "tool_choice": {
                    "description": "Controls how the model uses tools",
                    "oneOf": [
                      {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "const": "auto"
                          },
                          "disable_parallel_tool_use": {
                            "type": "boolean"
                          }
                        },
                        "required": ["type"],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "const": "any"
                          },
                          "disable_parallel_tool_use": {
                            "type": "boolean"
                          }
                        },
                        "required": ["type"],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "const": "tool"
                          },
                          "name": {
                            "type": "string",
                            "description": "Name of the specific tool to use"
                          },
                          "disable_parallel_tool_use": {
                            "type": "boolean"
                          }
                        },
                        "required": ["type", "name"],
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string",
                            "const": "none"
                          }
                        },
                        "required": ["type"],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "tools": {
                    "type": "array",
                    "description": "Server-side tools the agent can use",
                    "items": {
                      "oneOf": [
                        {
                          "type": "object",
                          "description": "Web Search Tool",
                          "properties": {
                            "type": {
                              "type": "string",
                              "const": "web_search_20250305"
                            },
                            "name": {
                              "type": "string",
                              "const": "web_search"
                            },
                            "max_uses": {
                              "type": "integer",
                              "minimum": 1,
                              "description": "Maximum searches per conversation"
                            },
                            "allowed_domains": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Only include results from these domains"
                            },
                            "blocked_domains": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Exclude results from these domains"
                            },
                            "user_location": {
                              "type": "object",
                              "description": "Localize search results",
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "const": "approximate"
                                },
                                "city": {
                                  "type": "string"
                                },
                                "region": {
                                  "type": "string"
                                },
                                "country": {
                                  "type": "string"
                                },
                                "timezone": {
                                  "type": "string"
                                }
                              },
                              "required": ["type"],
                              "additionalProperties": false
                            }
                          },
                          "required": ["type", "name"],
                          "additionalProperties": false
                        },
                        {
                          "type": "object",
                          "description": "Web Fetch Tool",
                          "properties": {
                            "type": {
                              "type": "string",
                              "const": "web_fetch_20250910"
                            },
                            "name": {
                              "type": "string",
                              "const": "web_fetch"
                            },
                            "max_uses": {
                              "type": "integer",
                              "minimum": 1,
                              "description": "Maximum fetches per conversation"
                            },
                            "allowed_domains": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Only fetch from these domains"
                            },
                            "blocked_domains": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Never fetch from these domains"
                            },
                            "citations": {
                              "type": "object",
                              "properties": {
                                "enabled": {
                                  "type": "boolean"
                                }
                              },
                              "required": ["enabled"],
                              "additionalProperties": false
                            },
                            "max_content_tokens": {
                              "type": "integer",
                              "minimum": 1,
                              "description": "Maximum content size to retrieve"
                            }
                          },
                          "required": ["type", "name"],
                          "additionalProperties": false
                        }
                      ]
                    }
                  },
                  "mcp_servers": {
                    "type": "array",
                    "description": "MCP servers for external integrations",
                    "items": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string",
                          "const": "url"
                        },
                        "url": {
                          "type": "string",
                          "format": "uri",
                          "description": "URL of the MCP server endpoint"
                        },
                        "name": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 100,
                          "description": "Human-readable name for the MCP server"
                        },
                        "authorization_token": {
                          "type": "string",
                          "description": "Bearer token for authentication (use env var interpolation)"
                        },
                        "tool_configuration": {
                          "type": "object",
                          "properties": {
                            "enabled": {
                              "type": "boolean"
                            },
                            "allowed_tools": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Only enable these tools"
                            },
                            "disabled_tools": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              },
                              "description": "Disable these tools"
                            }
                          },
                          "additionalProperties": false
                        }
                      },
                      "required": ["type", "url", "name"],
                      "additionalProperties": false
                    }
                  }
                },
                "additionalProperties": false
              }
            },
            "required": ["anthropic"],
            "additionalProperties": false
          }
        },
        "required": ["id", "name", "system_prompt", "model"],
        "additionalProperties": false
      }
    }
  },
  "required": ["version", "agents"],
  "additionalProperties": false,
  "examples": [
    {
      "version": "1.0",
      "agents": [
        {
          "id": "triage-bot",
          "name": "Triage Assistant",
          "system_prompt": "You are a triage specialist.\nClassify issues as BUG/FEATURE/QUESTION/TASK.\nSet priority P0-P3.",
          "model": {
            "anthropic": {
              "name": "claude-sonnet-4-20250514",
              "temperature": 0.7,
              "max_tokens": 4096
            }
          }
        }
      ]
    },
    {
      "version": "1.0",
      "agents": [
        {
          "id": "research-bot",
          "name": "Research Assistant",
          "description": "AI agent that can search the web for information",
          "system_prompt": "You are a research assistant.\nUse web search to find relevant information.\nAlways cite your sources.",
          "model": {
            "anthropic": {
              "name": "claude-sonnet-4-20250514",
              "temperature": 0.7,
              "max_tokens": 4096,
              "tool_choice": {
                "type": "auto"
              },
              "tools": [
                {
                  "type": "web_search_20250305",
                  "name": "web_search",
                  "max_uses": 5
                },
                {
                  "type": "web_fetch_20250910",
                  "name": "web_fetch",
                  "max_uses": 10,
                  "citations": {
                    "enabled": true
                  }
                }
              ]
            }
          }
        }
      ]
    }
  ]
}
